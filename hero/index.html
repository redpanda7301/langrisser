<!DOCTYPE html>
<html>
    <head>
        <title>랑그릿사 모바일</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />        
        <link rel="stylesheet" href="/assets/css/main.css" />
        <link rel="stylesheet" href="/assets/css/star-rating.css" media="all" type="text/css" />
        <link rel="icon" type="image/png" href="/favicon.png">
        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/util.js"></script>
        <script src="/assets/js/include-util.js"></script>
    </head>
    <body>
        <!-- Header -->
        <div data-include-path="/includes/header.html"></div>
        <div id="page-wrapper">
            <!-- Skin Carousel -->
            <div id="skin-carousel"></div>            
            <div id="main">
                <div class="container">
                    <div class="row main-row">
                        <!-- Basic Info -->
                        <div id="basic-info"></div>
                        <!-- Talent, Equip & Soldier Info -->
                        <div id="talent-soldier-info"></div>
                        <!-- Job Info -->
                        <div id="job-info"></div>
                        <!-- Material Info -->
                        <div id="material-info"></div>
                        <!-- Class Up Info -->
                        <div id="class-up-info"></div>
                        <!-- SP Condition Info -->
                        <div id="sp-condition-info"></div>
                        <!-- Skill Info -->
                        <div id="skill-info"></div>
                        <!-- Bio Info -->
                        <div id="bio-info"></div>
                        <!-- Performance Info -->
                        <div id="performance-info"></div>
                    </div>                    
                </div>                
            </div>
        </div>
        <!-- Footer -->
        <div data-include-path="/includes/footer.html"></div>
        <!-- Scripts -->        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.0/underscore-umd-min.js"></script>
        <script src="/assets/js/browser.min.js"></script>
        <script src="/assets/js/breakpoints.min.js"></script>        
        <script src="/assets/js/main_new.js"></script>
        <script src="/assets/js/star-rating.js" type="text/javascript"></script>        
        <script>            
            var slideIndex = 1;
            
            $(document).ready(function () {
                var heroName = getParameterByName("name");
                if (heroName !== null) {
                    var fileref = document.createElement("script");
                    fileref.setAttribute("type","text/javascript");
                    fileref.setAttribute("src", "/hero/data/" + heroName + ".js");
                    document.getElementsByTagName("head")[0].appendChild(fileref);
                }
                else {
                    location.href = "/hero.html";
                }             
            });

            window.onload = function() {
                var skinTemplate = _.template($("#skin-slideshow-template").html());
                var basicInfoTemplate = _.template($("#basic-info-template").html());
                var talentSoldierInfoTemplate = _.template($("#talent-soldier-info-template").html());
                var jobInfoTemplate = _.template($("#job-info-template").html());
                var materialInfoTemplate = _.template($("#material-info-template").html());
                var classUpInfoTemplate = _.template($("#class-up-info-template").html());
                var SPConditionInfoTemplate = _.template($("#sp-condition-info-template").html());
                var SkillInfoTemplate = _.template($("#skill-info-template").html());
                var BioInfoTemplate = _.template($("#bio-info-template").html());
                var PerformanceInfoTemplate = _.template($("#performance-info-template").html());

                $("#skin-carousel").replaceWith(skinTemplate(data[0]));
                $("#basic-info").replaceWith(basicInfoTemplate(data[0]));
                $("#talent-soldier-info").replaceWith(talentSoldierInfoTemplate(data[0]));
                $("#job-info").replaceWith(jobInfoTemplate(data[0]));
                $("#material-info").replaceWith(materialInfoTemplate(data[0]));
                $("#class-up-info").replaceWith(classUpInfoTemplate(data[0]));
                $("#sp-condition-info").replaceWith(SPConditionInfoTemplate(data[0]));
                $("#skill-info").replaceWith(SkillInfoTemplate(data[0]));
                $("#bio-info").replaceWith(BioInfoTemplate(data[0]));
                $("#performance-info").replaceWith(PerformanceInfoTemplate(data[0]));
                
                showSlides(slideIndex);

                $('#input-4').rating({
                    min: 0, max: 6, stars: 6,
                    captionElement: "#kv-caption",
                    starCaptions: {
                        1: data[0].Talent[0].Abilities[0].Desc,
                        2: data[0].Talent[0].Abilities[1].Desc,
                        3: data[0].Talent[0].Abilities[2].Desc,
                        4: data[0].Talent[0].Abilities[3].Desc,
                        5: data[0].Talent[0].Abilities[4].Desc,
                        6: data[0].Talent[0].Abilities[5].Desc
                    },
                    starCaptionClasses: {1: 'text-info', 2: 'text-info', 3: 'text-info', 4: 'text-info', 5: 'text-info', 6: 'text-info'},
                    filledStar: '<img src="/img/Icon/Icon_StarGold.png" width="35">',
                    emptyStar: '<img src="/img/Icon/Icon_StarGray.png" width="35">',
                });
                
                if (data[0].SPTalent != null) {
                    $('#input-5').rating({
                        min: 0, max: 6, stars: 6,
                        captionElement: "#sp-caption",
                        starCaptions: {
                            1: data[0].SPTalent[0].Abilities[0].Desc,
                            2: data[0].SPTalent[0].Abilities[1].Desc,
                            3: data[0].SPTalent[0].Abilities[2].Desc,
                            4: data[0].SPTalent[0].Abilities[3].Desc,
                            5: data[0].SPTalent[0].Abilities[4].Desc,
                            6: data[0].SPTalent[0].Abilities[5].Desc
                        },
                        starCaptionClasses: {1: 'text-info', 2: 'text-info', 3: 'text-info', 4: 'text-info', 5: 'text-info', 6: 'text-info'},
                        filledStar: '<img src="/img/Icon/Icon_StarGold.png" width="35">',
                        emptyStar: '<img src="/img/Icon/Icon_StarGray.png" width="35">',
                    });
                }
            }

            function getParameterByName(name, url = window.location.href) {
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }

            function getSkillType(type) {
                if (type === 1) {
                    return "물리피해";
                }
                else if (type === 2) {
                    return "마법피해";
                }
                else if (type === 3) {
                    return "초절강화";
                }
                else if (type === 4) {
                    return "지원";
                }
                else if (type === 5) {
                    return "치료";
                }
                else {
                    return "";
                }
            }

            function getDistance(distance) {
                if (distance === 0) {
                    return "자신";
                }
                else if (distance > 0) {
                    return distance + "칸";
                }
            }

            function getRange(range) {
                if (range === 1) {
                    return "단일";
                }
                else if (range === 98) {
                    return "직선";
                }
                else if (range === 99) {
                    return "맵전체";
                }
                else if (range > 1) {
                    return range + "칸";
                }
            }
        </script>

        <!-- Skin Carousel Template -->
        <script type="text/html" id="skin-slideshow-template">
            <div class="slideshow-container">
                <%_.each(Skins, function(skin) {%>
                <div class="mySlides fade">
                    <img src="/img/full/<%=skin.ImageUrl%>" style="width:100%">
                    <div class="text"><%=skin.Desc%></div>
                </div>
                <%});%>
                <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                <a class="next" onclick="plusSlides(1)">&#10095;</a>
            </div>
        </script>
        
        <!-- Basic Info Template -->
        <script type="text/html" id="basic-info-template">
            <div class="col-5 col-12-medium">
                <section>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="25%">
                            <col width="25%">
                            <col width="25%">
                            <col width="*">
                        </colgroup>
                        <tr>
                        <tr>
                            <th>이름</th>
                            <td colspan="3"><%=Name%></td>
                        </tr>
                        <tr>
                            <th>CV</th>
                            <td colspan="3"><%=CV%></td>
                        </tr>
                        <tr>
                            <th>희귀도</th>
                            <td colspan="3">
                                <%_.each(Rank, function(rank) {%>
                                <img src="/img/type/<%=rank%>.png" />
                                <%});%>
                                <%if (SP) {%>
                                <img src="/img/type/SP.png" width="16%" />
                                <%}%>
                            </td>
                        </tr>
                        <tr>
                            <th>세력</th>
                            <td colspan="3">
                                <%_.each(Groups, function(group) {%>
                                <img src="/img/group/<%=group%>.png" width="32" height="32" />
                                <%});%>
                            </td>
                        </tr>
                        <tr>
                            <th>생명</th>
                            <td>+<%=HP%>%</td>
                            <th>공격</th>
                            <td>+<%=Attk%>%</td>
                        </tr>
                        <tr>
                            <th>방어</th>
                            <td>+<%=Def%>%</td>
                            <th>마방</th>
                            <td>+<%=MagicDef%>%</td>
                        </tr>
                        <tr>
                            <th>획득법</th>
                            <td colspan="3" class="td_left"><%=HowToGet%></td>
                        </tr>
                        <%
                        var index = 1;
                        _.each(Fetters, function(fetter) {
                        %>
                        <tr>
                            <th><img src="/img/Icon/Spirit<%=index%>.png" width="32" height="32" /></th>
                            <td colspan="3"><%=fetter.Condition%></td>
                        </tr>                
                        <%
                            index++;
                        });
                        %>
                        <tr>
                            <th><img src="/img/Icon/Icon_pink.png" width="32" height="32" /></th>
                            <td colspan="3"><%=HeartFetter%></td>
                        </tr>
                    </table>
                </section>
            </div>
        </script>

        <!-- Talent & Soldier Info -->
        <script type="text/html" id="talent-soldier-info-template">
            <div class="col-7 col-12-medium">
                <section>
                    <table>
                        <tr><th colspan="2">고유기술 : <%=Talent[0].Name%></th></tr>
                        <tr><td><img src="/img/ability/<%=Talent[0].Icon%>" width="100px" height="90px" /></td><th><input id="input-4" name="input-4" value="6" class="rating-loading"></th>
                        <tr><td colspan="2"><span id="kv-caption"></span></td></tr>
                        <%if (SPTalent != null) {%>
                        <tr><th colspan="2">SP 고유기술 : <%=SPTalent[0].Name%></th></tr>
                        <tr><td><img src="/img/ability/<%=SPTalent[0].Icon%>" width="100px" height="90px" /></td><th><input id="input-5" name="input-5" value="6" class="rating-loading"></th>
                        <tr><td colspan="2"><span id="sp-caption"></span></td></tr>
                        <%}%>
                        <tr>
                            <th colspan="2"><%=Equip.Name%></th>
                        </tr>
                        <tr>
                            <th>능력치</th>
                            <td><%=Equip.Stats%></td>
                        </tr>
                        <tr>
                            <th><img src="/img/equip/<%=Equip.Icon%>" width="100px" /></th>
                            <td>
                                <%=Equip.Ability%>
                            </td>
                        </tr>
                        <tr>
                            <th colspan="2">용병</th>
                        <tr>
                            <td colspan="2">
                                <%_.each(Soldiers, function(soldier) {%>
                                <span><img src="/img/troop/<%=soldier%>.png" /></span>
                                <%});%>
                            </td>
                        </tr>
                    </table>
                </section>
            </div>
        </script>

        <!-- Job Info -->
        <script type="text/html" id="job-info-template">
            <%
              var colNum = 12 / Jobs.length;
              var index = 1;
              _.each(Jobs, function(job) {
            %>
            <div class="col-<%=colNum%> col-12-medium">
                <section>
                    <div class="view_title">클래스 최종 능력치(70레벨 호감도4,5 10레벨)</div>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="20%">
                            <col width="30%">
                            <col width="20%">
                            <col width="*">
                        </colgroup>
                        <tr>
                            <th rowspan="2">클래스</th>
                            <td colspan="3"><%=job.Name%><img src="/img/troop/<%=job.Icon%>" width="35px" /></td>
                        <tr>
                            <td colspan="4">
                                <%_.each(job.SD, function(sd) {%>
                                <div class="class<%=index%>">
                                    <img src="/img/SD/<%=sd.ImageUrl%>" style=" height:131px">
                                </div>
                                <%});%>                               
                            </td>
                        </tr>
                        </tr>
                        <tr>
                            <th><img src="/img/Icon/Icon_Range.png" width="30px" /></th>
                            <td><%=job.AttkRange%></td>
                            <th><img src="/img/Icon/Move_<%=job.MoveType%>.png" width="30px" /></th>
                            <td><%=job.Move%></td>
                        </tr>
                        <tr>
                            <th>생명</th>
                            <td class="td_graph" colspan="3">
                                <span class="graph_bg"><em class="graph_line bg_hp" style="width: <%=job.HPRate%>%;"></em></span>
                                <strong class="graph_point col_olive"><%=job.HP%></strong>
                            </td>
                        </tr>
                        <tr>
                            <th>공격</th>
                            <td class="td_graph" colspan="3">
                                <span class="graph_bg"><em class="graph_line bg_atk" style="width: <%=job.AttkRate%>%;"></em></span>
                                <strong class="graph_point col_orange"><%=job.Attk%></strong>
                            </td>
                        </tr>
                        <tr>
                            <th>지력</th>
                            <td class="td_graph" colspan="3">
                                <span class="graph_bg"><em class="graph_line bg_matk" style="width: <%=job.IntRate%>%;"></em></span>
                                <strong class="graph_point col_blue"><%=job.Int%></strong>
                            </td>
                        </tr>
                        <tr>
                            <th>방어</th>
                            <td class="td_graph" colspan="3">
                                <span class="graph_bg"><em class="graph_line bg_def" style="width: <%=job.DefRate%>%;"></em></span>
                                <strong class="graph_point col_yellow"><%=job.Def%></strong>
                            </td>
                        </tr>
                        <tr>
                            <th>마방</th>
                            <td class="td_graph" colspan="3">
                                <span class="graph_bg"><em class="graph_line bg_mdef" style="width: <%=job.MagicDefRate%>%;"></em></span>
                                <strong class="graph_point col_purple"><%=job.MagicDef%></strong>
                            </td>
                        </tr>
                        <tr>
                            <th>기술</th>
                            <td class="td_graph" colspan="3">
                                <span class="graph_bg"><em class="graph_line bg_cri" style="width: <%=job.SkillRate%>%;"></em></span>
                                <strong class="graph_point col_purple"><%=job.Skill%></strong>
                            </td>
                        </tr>
                        <tr>
                            <th>마음의유대4</th>
                            <td class="td_left" colspan="3">
                                <%=job.HeartFetterBouns1%>
                            </td>
                        </tr>
                        <tr>
                            <th>마음의유대7</th>
                            <td class="td_left" colspan="3">
                                <%=job.HeartFetterBouns2%>
                            </td>
                        </tr>
                    </table>
                </section>
            </div>
            <% 
                index++;
              });
            %>
        </script>

        <!-- Material Info -->
        <script type="text/html" id="material-info-template">
            <div class="col-6 col-12-medium">
                <div class="view_title">재료정보</div>
                <section>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="22%">
                            <col width="*">
                        </colgroup>
                        <tr>
                            <th>중앙2~10순서</th>
                            <td class="td_rank">
                                <%_.each(Materials.HeartFetter, function(material) {%>
                                <img src="/img/heart/<%=material%>.png">
                                <%});%>
                            </td>
                        </tr>
                        <tr>
                            <th>유대</th>
                            <td class="td_rank">
                                <%_.each(Materials.Fetter, function(material) {%>
                                    <img src="/img/heart/<%=material%>.png">
                                <%});%>                                
                            </td>
                        </tr>
                        <tr>
                            <th>각성</th>
                            <td class="td_rank">
                                <%_.each(Materials.Awaken, function(material) {%>
                                    <img src="/img/classup/<%=material%>.png">
                                <%});%>
                            </td>
                        </tr>
                    </table>
                </section>
            </div>
        </script>

        <!-- Class Up Info -->
        <script type="text/html" id="class-up-info-template">
            <%
              var counter = 0;
              var colNum = 6;
              _.each(ClassUp, function(classUp) {
                if (ClassUp.length > 6 && counter >= 2) {
                    colNum = 4;
                }
            %>
            <%if (counter % 2 == 0) {%>     
            <div class="col-<%=colNum%> col-12-medium">
            <%}%>
                <section>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="22%">
                            <col width="*">
                        </colgroup>
                        <div class="view_title"><%=classUp.ClassTitle%></div>
                        <%_.each(classUp.Tiers, function(tier) {%>
                        <tr>
                            <th><%=tier.Name%></th>
                            <td class="td_rank">
                                <%_.each(tier.Materials, function(material) {%>
                                <img src="/img/classup/<%=material%>.png">
                                <%});%>                                
                            </td>
                        </tr>
                        <%});%>                        
                    </table>
                </section>
            <%if (counter % 2 == 1 || counter == ClassUp.length) {%>   
            </div>
            <%}%>
            <%                
                counter++;
              });
            %>
        </script>

        <!-- SP Condition Info -->
        <script type="text/html" id="sp-condition-info-template">
            <%if (SPOpenConditions != null) {%>
            <div class="col-12">
                <section>
                    <div class="view_title">SP 각성 조건</div>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="25%">
                            <col width="*">
                        </colgroup>
                        <%_.each(SPOpenConditions, function(condition) {%>                        
                        <tr>
                            <%if (condition.Name !== "") {%>
                                <th><%=condition.Name%></th>
                                <%if (condition.Materials.length > 0) {%>
                                <td>
                                    <%_.each(condition.Materials, function(material) {%>
                                    <img src="/img<%=material.MaterialImgUrl%>" style="width:10%">x <%=material.Amount%>
                                    <%});%>
                                </td>
                                <%}%>
                                <%if (condition.Desc !== "") {%>
                                    <td><%=condition.Desc%></td>
                                <%}%>
                            <%} else {%>                            
                                <th colspan="2"><%=condition.Desc%></th>                            
                            <%}%>                            
                        </tr>                        
                        <%});%>
                    </table>
                </section>
            </div>
            <%}%>
        </script>

        <!-- Skill Info -->
        <script type="text/html" id="skill-info-template">
            <div class="col-12">
                <section>
                    <div class="view_title">스킬 정보</div>
                    <%_.each(Skills, function(skill) {%>
                    <%if (skill.IsPassive != true) {%>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="22%">
                            <col width="28%">
                            <col width="22%">
                            <col width="*">
                        </colgroup>
                        <tr>
                            <td colspan="4"><b><font color="#0070c0"><%=skill.Name%>(COST <%=skill.Cost%>)</font></b></td>
                        </tr>
                        <tr>
                            <th>유형</th>
                            <td><%=getSkillType(skill.Type)%></td>
                            <th>쿨타임</th>
                            <td><%=skill.CoolTime%>턴</td>
                        </tr>
                        <tr>
                            <th>사거리</th>
                            <td><%=getDistance(skill.Distance)%></td>
                            <th>범위</th>
                            <td><%=getRange(skill.Range)%></td>
                        </tr>
                        <tr>
                            <th><img src="<%=skill.IconImageUrl%>" width="100" /></th>
                            <td colspan="3">
                                <%=skill.Desc%>
                            </td>
                        </tr>
                        <%if (skill.Animation != "") {%>
                        <tr>
                            <td colspan="4"><img src="<%=skill.Animation%>" width="70%"/></td>
                        </tr>
                        <%}%>
                    </table>
                    <%} else {%>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="22%">
                            <col width="28%">
                            <col width="22%">
                            <col width="*">
                        </colgroup>
                        <tr>
                            <td colspan="4"><b><font color="#0070c0"><%=skill.Name%>(COST <%=skill.Cost%>)</font></b></td>
                        </tr>
                        <tr>
                            <th>유형</th>
                            <td>패시브</td>
                        </tr>
                        <tr>
                            <th><img src="/img/skills/<%=skill.IconImage%>" width="100" /></th>
                            <td colspan="3">
                                <%=skill.Desc%>
                            </td>
                        </tr>
                    </table>
                    <%}%>
                    <%});%>
                </section>
            </div>
        </script>

        <!-- Bio Info -->
        <script type="text/html" id="bio-info-template">
            <div class="col-12">
                <section>
                    <div class="view_title">생애</div>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="25%">
                            <col width="*">
                        </colgroup>
                        <%_.each(Bio, function(bio) {%>
                        <tr>
                            <th><%=bio.Entry%></th>
                            <td>
                                <%=bio.Desc%>
                            </td>
                        </tr>
                        <%});%>
                    </table>
                </section>
            </div>
        </script>

        <!-- Performance Info -->
        <script type="text/html" id="performance-info-template">
            <div class="col-12">
                <section>
                    <div class="view_title">대사</div>
                    <table border="0" cellpadding="0" cellspacing="1">
                        <colgroup>
                            <col width="25%">
                            <col width="*">
                        </colgroup>
                        <%_.each(Performance, function(performance) {%>
                        <tr>
                            <th><%=performance.Entry%></th>
                            <td>
                                <%=performance.Desc%>
                            </td>
                        </tr>
                        <%});%>
                    </table>
                </section>
            </div>
        </script>

        <script>
            function plusSlides(n) {
                showSlides(slideIndex += n);
            }

            function currentSlide(n) {
                showSlides(slideIndex = n);
            }
    
            function showSlides(n) {
                var i;
                var slides = document.getElementsByClassName("mySlides");
                var sd1 = document.getElementsByClassName("class1");
                var sd2 = document.getElementsByClassName("class2");
                var sd3 = document.getElementsByClassName("class3");  
                // var dots = document.getElementsByClassName("dot");
                if (n > slides.length) {
                    slideIndex = 1
                }
                if (n < 1) {
                    slideIndex = slides.length
                }
                for (i = 0; i < slides.length; i++) {
                    slides[i].style.display = "none";
                    if (sd1.length) {
                        sd1[i].style.display = "none";
                    }
                    if (sd2.length) {
                        sd2[i].style.display = "none";
                    }
                    if (sd3.length) {
                        sd3[i].style.display = "none";
                    }                    
                }
                // for (i = 0; i < dots.length; i++) {
                //      dots[i].className = dots[i].className.replace(" active", "");
                //  }
                slides[slideIndex-1].style.display = "block";
                if (sd1.length) {
                    sd1[slideIndex-1].style.display = "block";
                }
                if (sd2.length) {
                    sd2[slideIndex-1].style.display = "block";
                }
                if (sd3.length) {
                    sd3[slideIndex-1].style.display = "block";
                }
                // dots[slideIndex-1].className += " active";
            }
        </script>
    </body>
</html>